<!DOCTYPE html>
<html lang="en">

<head>
    <!--BOOTSTRAP CDN-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!--END OF BOOTSTRAP CDN-->
    <script type="text/javascript" src="indexScripts.js"></script>
    <link rel="stylesheet" href="CSS Sheets/index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body id="body-overrides">

    <!--THIS ROW IS FOR THE TOP OF THE WEBPAGE, USED FOR THE REALTYYC BANNER AND MENU OPTIONS-->

    <nav class="navbar navbar-expand-sm">
        <div class="container-fluid">

            <a class="navbar-brand" href="#">
                <img src="House Images/logo.png" class="img-fluid" alt="...">
            </a>

            <form class="container-fluid">
                <input type="text" placeholder="Search By Address...">
                <button class="btn btn-secondary" type="button">Search</button>
                <button class="btn btn-secondary" type="button">How To List</button>
                <button class="btn btn-secondary" type="button" onclick="location.href = 'favoritedListings.html'">View
                    Favorited Listings</button>
                <button class="btn btn-secondary" type="button" onclick="location.href = 'realtors.html'">Current
                    Realtors</button>
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Filter Search for a Home
                </a>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink" style="width:700px;">
                    <form class="px-4 py-3">
                        <p style="margin-left: 20px;"><b>Advanced Search Filters:</p>
                        <select style="margin-left: 20px; width: 60%;" id="type" class="form-select"
                            aria-label="Home Type">
                            <option selected>Home Type</option>
                            <option>House</option>
                            <option>Condominium</option>
                            <option>Duplex</option>
                            <option>Bungalow</option>
                            <option>Bi-level</option>
                        </select>
                        <select style="margin-left: 20px; width: 60%;" id="beds" class="form-select"
                            aria-label="Minimum No. of Bedrooms">
                            <option selected>No. of Bedrooms</option>
                            <option value="1">One Bedroom</option>
                            <option value="2">Two Bedrooms</option>
                            <option value="3">Three Bedrooms</option>
                            <option value="4">Four or more Bedrooms</option>
                        </select>
                        <select style="margin-left: 20px; width: 60%;" id="baths" class="form-select"
                            aria-label="Minimum No. of Bathrooms">
                            <option selected>No. of Bathrooms</option>
                            <option value="1">One Bathroom</option>
                            <option value="2">Two Bathrooms</option>
                            <option value="3">Three Bathrooms</option>
                            <option value="4">Four or more Bathrooms</option>
                        </select>
                        <select style="margin-left: 20px; width: 60%;" id="garages" class="form-select"
                            aria-label="Minimum. of Garages">
                            <option selected>No. of Garages</option>
                            <option value="0">Zero Garages</option>
                            <option value="1">One Garage</option>
                            <option value="2">Two or more Garages</option>
                        </select>
                        <label style="margin-left: 20px; margin-top: 10px;" for="MinimumPrice"
                            class="form-label">Minimum Price: <span id="minPrice"></span>
                            $</label>
                        <input type="range" class="form-range" min="100000" max="1000000" id="MinimumPrice"
                            value="250000">
                        <label style="margin-left: 20px;" for="MaximumPrice" class="form-label">Maximum Price: <span
                                id="maxPrice"></span>
                            $</label>
                        <input type="range" class="form-range" min="100000" max="1000000" id="MaximumPrice"
                            value="750000">
                        <label style="margin-left: 20px;" for="MinimumSize" class="form-label">Minimum Size: <span
                                id="minSize"></span> sq.
                            ft.</label>
                        <input type="range" class="form-range" min="1000" max="5000" id="MinimumSize" value="1700">
                        <label style="margin-left: 20px;" for="MaximumSize" class="form-label">Maximum Size: <span
                                id="maxSize"></span> sq.
                            ft.</label>
                        <input type="range" class="form-range" min="1000" max="5000" id="MaximumSize" value="3900">
                        <p style="margin-left: 20px;">Check the boxes below for your additional options:</p>
                        <label style="margin-left: 20px;" for="backyard" class="form-label">Backyard?</label>
                        <input class="form-check-input" type="checkbox" id="backyard" name="backyard">
                        <label style="margin-left: 20px;" for="basement" class="form-label">Finished Basement?</label>
                        <input class="form-check-input" type="checkbox" id="basement" name="basement">
                        <label style="margin-left: 20px;" for="airCond" class="form-label">Air Conditioning?</label>
                        <input class="form-check-input" type="checkbox" id="airCond" name="airCond">
                        <label style="margin-left: 20px;" for="fireplace" class="form-label">Fireplace?</label>
                        <input class="form-check-input" type="checkbox" id="fireplace" name="fireplace">
                        <label style="margin-left: 20px;" for="dWay" class="form-label">Driveway?</label>
                        <input class="form-check-input" type="checkbox" id="dWay" name="dWay">
                        <label style="margin-left: 20px;" for="pool" class="form-label">Hot Tub/Pool?</label>
                        <input class="form-check-input" type="checkbox" id="pool" name="pool">
                        <button
                            style="margin-left:auto; margin-right:auto; margin-bottom:5px; display:block; width:40%;"
                            type="button" id="filter" class="btn btn-primary">Search</button>
                        <button style="margin-left:auto; margin-right:auto; display:block; width:40%;" type="button"
                            id="reset" onclick="event.stopPropagation();" class="btn btn-primary">Reset Filters</button>

                        <script>
                            var minPriceSlider = document.getElementById("MinimumPrice");
                            var maxPriceSlider = document.getElementById("MaximumPrice");
                            var minSizeSlider = document.getElementById("MinimumSize");
                            var maxSizeSlider = document.getElementById("MaximumSize");
                            var minPriceOutput = document.getElementById("minPrice");
                            var maxPriceOutput = document.getElementById("maxPrice");
                            var minSizeOutput = document.getElementById("minSize");
                            var maxSizeOutput = document.getElementById("maxSize");

                            minPriceOutput.innerHTML = minPriceSlider.value;
                            maxPriceOutput.innerHTML = maxPriceSlider.value;
                            minSizeOutput.innerHTML = minSizeSlider.value;
                            maxSizeOutput.innerHTML = maxSizeSlider.value;

                            minPriceSlider.oninput = function () {
                                minPriceOutput.innerHTML = this.value;
                            }

                            maxPriceSlider.oninput = function () {
                                maxPriceOutput.innerHTML = this.value;
                            }

                            minSizeSlider.oninput = function () {
                                minSizeOutput.innerHTML = this.value;
                            }

                            maxSizeSlider.oninput = function () {
                                maxSizeOutput.innerHTML = this.value;
                            }
                        </script>

                    </form>
                </div>
            </form>
        </div>
    </nav>


    <!-- LISTING CONTAINER, EACH ROW IS A NEW LISTING TO SHOW OUR CLIENTS -->
    <div class="container-fluid overflow-hidden" id="listings-container">

        <!--LISTING ONE-->
        <div class="row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides">
            <div class="col-sm-3">
                <img src="House Images/DefaultHouse.jpg" class="img-fluid img-thumbnail" alt="..." id="listing-1-image">
            </div>
            <div class="col-sm-9" id="listing1">
                <div class="row">
                    <div class="col-sm-3 fs-4" id="listing-1-price">
                    </div>
                    <div class="col-sm-6 fs-4 text-center" id="listing-1-location">
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="listing-1-desc">
                    </div>
                </div>
                <div class="row">
                    <button name="view-1" type="button" class="btn btn-primary"
                    style="width: 200px; margin-top: 20px;" 
                    onclick='saveListing(document.getElementsByName("view-1")[0].id)'>View Listing</button>


                </div>
            </div>
        </div>

        <!--LISTING TWO-->
        <div class="row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides">
            <div class="col-sm-3">
                <img src="House Images/DefaultHouse.jpg" class="img-fluid img-thumbnail" alt="..." id="listing-2-image">
            </div>
            <div class="col-sm-9">
                <div class="row">
                    <div class="col-sm-3 fs-4" id="listing-2-price">
                    </div>
                    <div class="col-sm-6 fs-4 text-center" id="listing-2-location">
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="listing-2-desc">
                    </div>
                </div>
                <div class="row">
                    <button name="view-2" type="button" class="btn btn-primary"
                    style="width: 200px; margin-top: 20px;"
                        onclick='saveListing(document.getElementsByName("view-2")[0].id)'>View Listing</button>
                </div>
            </div>
        </div>

        <!--LISTING THREE-->
        <div class="row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides">
            <div class="col-sm-3">
                <img src="House Images/DefaultHouse.jpg" class="img-fluid img-thumbnail" alt="..." id="listing-3-image">
            </div>
            <div class="col-sm-9">
                <div class="row">
                    <div class="col-sm-3 fs-4" id="listing-3-price">
                    </div>
                    <div class="col-sm-6 fs-4 text-center" id="listing-3-location">
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="listing-3-desc">
                    </div>
                </div>
                <div class="row">
                    <button name="view-3" type="button" class="btn btn-primary"
                    style="width: 200px; margin-top: 20px;"
                        onclick='saveListing(document.getElementsByName("view-3")[0].id)'>View Listing</button>
                </div>
            </div>
        </div>

        <!--LISTING FOUR-->
        <div class="row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides">
            <div class="col-sm-3">
                <img src="House Images/DefaultHouse.jpg" class="img-fluid img-thumbnail" alt="..." id="listing-4-image">
            </div>
            <div class="col-sm-9">
                <div class="row">
                    <div class="col-sm-3 fs-4" id="listing-4-price">
                    </div>
                    <div class="col-sm-6 fs-4 text-center" id="listing-4-location">
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="listing-4-desc">
                    </div>
                </div>
                <div class="row">
                    <button name="view-4" type="button" class="btn btn-primary"
                    style="width: 200px; margin-top: 20px;"
                        onclick='saveListing(document.getElementsByName("view-4")[0].id)'>View Listing</button>
                </div>
            </div>
        </div>

        <!--LISTING FIVE-->
        <div class="row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides">
            <div class="col-sm-3">
                <img src="House Images/DefaultHouse.jpg" class="img-fluid img-thumbnail" alt="..." id="listing-5-image">
            </div>
            <div class="col-sm-9">
                <div class="row">
                    <div class="col-sm-3 fs-4" id="listing-5-price">
                    </div>
                    <div class="col-sm-6 fs-4 text-center" id="listing-5-location">
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="listing-5-desc">
                    </div>
                </div>
                <div class="row flex-grow-1">
                    <button name="view-5" type="button" class="btn btn-primary"
                    style="width: 200px; margin-top: 20px;"
                        onclick='saveListing(document.getElementsByName("view-5")[0].id)'>View Listing</button>
                </div>
            </div>
        </div>

    </div>

    <div class="container-fluid text-center">
        <div class="row">
            <button id="load-more" class="btn btn-danger" onclick="loadMoreListings()">Load More Listings</button>
        </div>
    </div>

    <script type="text/javascript">
        window.name = "index";
        const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'CAD' });
        let loc = "Location: ";
        let price = "Price: "

        /* 

        Brandon I commented this out temporarily so I could work on the filtering. I think that the "window.onload" may be causing you some problems
        and why its not working for you. I have a window.onload in indexScripts.js that may be the cause of some problems, because I know when I comment this one 
        out, my other one works fine. You can try commenting mine out when you need to work on it, and we can set up a time to fix both of them sometime this weekend.

        //TODO: Come back and fix this piece of shit for storing the favorited listings correctly
        window.onload = storeInLocalStorage();
        window.onload = updateListingsFromStorage();
        */

        /*var listing = JSON.parse(sessionStorage.getItem("listings"));
        for(let index = 0; index < listing.length; index++)
        {
            if(listing[index].isFavorited == true)
            {
                window.alert(listing[index].listingID + " is favorited!");
            }
        }*/

        // if the listings are not in storage, store them
        if (sessionStorage.getItem("listings") == null) {
            storeInLocalStorage();
        }

        // update listings to be not listed for listing purposes
        var stored_listings = JSON.parse(sessionStorage.getItem("listings"));
        for (var i = 0; i < stored_listings.length; i++) {
            stored_listings[i].isListed = false;
        }
        sessionStorage.setItem("listings", JSON.stringify(stored_listings));

        // begin listing with 5 random listings
        for (let index = 1; index < 6; index++) {
            var ran = Math.floor(Math.random() * 10);
            var listing = getRandomListing(ran);
            while (listing.isListed) {
                ran = Math.floor(Math.random() * 10);
                listing = getRandomListing(ran);
            }
            document.getElementById("listing-" + index + "-image").src = listing.image;
            document.getElementById("listing-" + index + "-price").innerHTML = price.concat(formatter.format(listing.price));
            document.getElementById("listing-" + index + "-desc").innerHTML = listing.longDesc;
            document.getElementById("listing-" + index + "-location").innerHTML = loc.concat(listing.location);
            document.getElementsByName("view-" + index)[0].setAttribute("id", listing.listingID);
            setListed(ran);
        }

        function saveListing(id) {
            sessionStorage.setItem("id", id);
            location.href = "listingInformation.html"
        }

        function loadMoreListings() {

            //LOAD THE REMAINING FIVE LISTINGS
            for (let int = 6; int < 11; int++) {

                //TRY AND GET A LISTING
                var listing = getUnlistedListing();

                //IF NO LISTING RETURNED, DONT BOTHER
                if (typeof listing !== 'undefined') {

                    //CREATE OUTER DIV
                    const newDiv = document.createElement("div");
                    newDiv.setAttribute("class", "row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides");
                    newDiv.setAttribute("id", "listing" + int);
                    newDiv.setAttribute("name", "listing" + int);

                    document.getElementById("listings-container").append(newDiv);

                    //CREATE OUTTER IMG CONTAINER
                    const imgDiv = document.createElement("div");
                    imgDiv.setAttribute("class", "col-sm-3");
                    imgDiv.setAttribute("id", "listing" + int + "-img-div");

                    document.getElementById("listing" + int).append(imgDiv);

                    //CREATE THE IMG ELEMENT
                    const img = document.createElement("img");
                    img.setAttribute("class", "img-fluid img-thumbnail");
                    img.setAttribute("id", "listing-" + int + "-image");

                    document.getElementById("listing" + int + "-img-div").append(img);

                    //CREATE THE LISTING INFO DIV
                    const listDiv = document.createElement("div");
                    listDiv.setAttribute("class", "col-sm-9");
                    listDiv.setAttribute("id", "listing-info-" + int);

                    document.getElementById("listing" + int).append(listDiv);

                    //CREATE THE PRICE AND LOCATION DIVS CONTAINER
                    const priceLocDiv = document.createElement("div");
                    priceLocDiv.setAttribute("class", "row");
                    priceLocDiv.setAttribute("id", "listing-" + int + "-priceLoc");

                    document.getElementById("listing-info-" + int).append(priceLocDiv);

                    //CREATE PRICE DIV
                    const priceDiv = document.createElement("div");
                    priceDiv.setAttribute("class", "col-sm-3 fs-4");
                    priceDiv.setAttribute("id", "listing-" + int + "-price");

                    document.getElementById("listing-" + int + "-priceLoc").append(priceDiv);

                    //CREAT LOCATION DIV
                    const locDiv = document.createElement("div");
                    locDiv.setAttribute("class", "col-sm-6 fs-4 text-center");
                    locDiv.setAttribute("id", "listing-" + int + "-location");

                    document.getElementById("listing-" + int + "-priceLoc").append(locDiv);

                    //CREATE THE DESCRIPTION CONTAINER
                    const descDiv = document.createElement("div");
                    descDiv.setAttribute("class", "row");
                    descDiv.setAttribute("id", "listing-" + int + "-dec");

                    document.getElementById("listing-info-" + int).append(descDiv);

                    //CREATE THE DESCRIPTION DIV
                    const descInfoDiv = document.createElement("div");
                    descInfoDiv.setAttribute("class", "col");
                    descInfoDiv.setAttribute("id", "listing-" + int + "-desc");

                    document.getElementById("listing-" + int + "-dec").append(descInfoDiv);

                    //CREATE THE BUTTON CONTAINER
                    const buttonDiv = document.createElement("div");
                    buttonDiv.setAttribute("class", "row");
                    buttonDiv.setAttribute("id", "listing-" + int + "-btn");

                    document.getElementById("listing-info-" + int).append(buttonDiv);

                    //CREATE THE BUTTON
                    const viewButton = document.createElement("BUTTON");
                    viewButton.setAttribute("class", "btn btn-primary");
                    viewButton.setAttribute("id", listing.listingID);
                    viewButton.setAttribute("name", "view-" + int);
                    viewButton.onclick = function () { saveListing(document.getElementsByName("view-" + int)[0].id) }
                    viewButton.innerHTML = "View Listing";
                    // Set width and height (adjust these values as needed)
                    viewButton.style.width = "200px";
                    viewButton.style.height = "40px";
                    viewButton.style.marginTop = "20px";

                    document.getElementById("listing-" + int + "-btn").append(viewButton);

                    //FILL THE APPROPIATE INFORMATION INTO THE DIVS
                    document.getElementById("listing-" + int + "-image").src = listing.image;
                    document.getElementById("listing-" + int + "-price").innerHTML = price.concat(formatter.format(listing.price));
                    document.getElementById("listing-" + int + "-desc").innerHTML = listing.longDesc;
                    document.getElementById("listing-" + int + "-location").innerHTML = loc.concat(listing.location);

                } else {
                    document.getElementById("load-more").innerHTML = "Out Of Listings!";
                    document.getElementById("load-more").disabled = true;
                    console.log("out of listings!");
                    break;
                }
            }
        }

        function updateListings(filteredListings) {
            // Get the container element where the listings are displayed
            var listingsContainer = document.getElementById('listings-container');

            // Clear the container
            listingsContainer.innerHTML = '';

            // Add the filtered listings to the container
            filteredListings.forEach(function (listing) {
                // Create a new div for the listing
                var listingDiv = document.createElement('div');
                listingDiv.className = 'row border border-2 border-dark-subtle rounded-top rounded-bottom mb-1 row-overrides';

                // Add the listing details to the div
                listingDiv.innerHTML = `
                    <div class="col-sm-3">
                        <img src="${listing.image}" class="img-fluid img-thumbnail" alt="..." id="listing-${listing.listingID}-image">
                    </div>
                    <div class="col-sm-9" id="listing${listing.listingID}">
                        <div class="row">
                            <div class="col-sm-3 fw-bold fs-2" id="listing-${listing.listingID}-price">
                                ${listing.price}
                            </div>
                            <div class="col-sm-7 fw-bold fs-3 text-center" id="listing-${listing.listingID}-location">
                                ${listing.location}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col fs-3" id="listing-${listing.listingID}-desc">
                                ${listing.description}
                            </div>
                        </div>
                        <div class="row">
                            <button name="view-${listing.listingID}" type="button" class="btn btn-primary"
                                onclick='saveListing(document.getElementsByName("view-${listing.listingID}")[0].id)'>View Listing</button>
                        </div>
                    </div>
                `;

                // Add the listing div to the container
                listingsContainer.appendChild(listingDiv);
            });
        }

        function onSubmitForm() {
            var bedrooms = document.getElementById('bedrooms').value;
            var bathrooms = document.getElementById('bathrooms').value;
            var garages = document.getElementById('garages').value;
            var minPrice = document.getElementById('minPrice').value;
            var maxPrice = document.getElementById('maxPrice').value;
            var minSize = document.getElementById('minSize').value;
            var maxSize = document.getElementById('maxSize').value;

            var criteria = {
                noBedrooms: { min: parseInt(bedrooms) },
                noBathrooms: { min: parseInt(bathrooms) },
                noGarage: { min: parseInt(garages) },
                price: { min: parseInt(minPrice), max: parseInt(maxPrice) },
                houseSize: { min: parseInt(minSize), max: parseInt(maxSize) }
            };

            var filteredListings = filterListings(listings, criteria);
            updateListings(filteredListings);
        }
    </script>

</body>

</html>